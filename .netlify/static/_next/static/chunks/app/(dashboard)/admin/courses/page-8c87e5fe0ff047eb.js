(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{9586:function(e,t,n){Promise.resolve().then(n.bind(n,9839))},4562:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(7461).Z)("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]])},1930:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(7461).Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]])},7841:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(7461).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2518:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(7461).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},9295:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(7461).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]])},489:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(7461).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},9839:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return v}});var r=n(3827),s=n(4090),i=n(7269),a=n(7907),l=n(1097),o=n(575),c=n(6862),u=n(2518),d=n(7841),f=n(1930),m=n(4562),p=n(9295),h=n(489),x=n(8792);function v(){let{profile:e,loading:t}=(0,i.a)(),n=(0,a.useRouter)(),{toast:v}=(0,c.pm)(),[y,g]=(0,s.useState)([]),[b,j]=(0,s.useState)(!0);(0,s.useEffect)(()=>{if(!t&&e){if("admin"!==e.role&&"teacher"!==e.role){n.push("/");return}N()}},[t,e]);let N=async()=>{let e=(0,l.e)(),{data:t,error:n}=await e.from("courses").select("\n        *,\n        lessons(count)\n      ").order("level").order("order");t&&g(t.map(e=>{var t,n;return{id:e.id,title:e.title,description:e.description,level:e.level,order:e.order,is_published:e.is_published,lessonCount:(null===(n=e.lessons)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.count)||0,created_at:e.created_at}})),j(!1)},w=async(e,t)=>{let n=(0,l.e)(),{error:r}=await n.from("courses").update({is_published:!t}).eq("id",e);r?v({title:"操作失败",description:r.message,variant:"destructive"}):(v({title:t?"课程已下架":"课程已发布"}),N())},k=async e=>{if(!confirm("确定要删除这个课程吗? 所有关卡也会被删除。"))return;let t=(0,l.e)(),{error:n}=await t.from("courses").delete().eq("id",e);n?v({title:"删除失败",description:n.message,variant:"destructive"}):(v({title:"课程已删除"}),N())};return t||!e?(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,r.jsx)("div",{className:"loading-spinner"})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-blue-50 p-6",children:(0,r.jsxs)("div",{className:"mx-auto max-w-6xl",children:[(0,r.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"mb-2 text-3xl font-bold text-gray-900",children:"课程管理"}),(0,r.jsx)("p",{className:"text-gray-600",children:"创建和管理课程内容"})]}),(0,r.jsx)(x.default,{href:"/admin/courses/new",children:(0,r.jsxs)(o.z,{className:"gap-2",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4"}),"创建课程"]})})]}),b?(0,r.jsx)("div",{className:"py-12 text-center",children:(0,r.jsx)("div",{className:"loading-spinner mx-auto"})}):y.length>0?(0,r.jsx)("div",{className:"space-y-4",children:y.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-6 rounded-xl border bg-white p-6 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"mb-2 flex items-center gap-3",children:[(0,r.jsxs)("span",{className:"rounded-full bg-blue-100 px-3 py-1 text-sm font-medium text-blue-700",children:["Level ",e.level]}),e.is_published?(0,r.jsxs)("span",{className:"flex items-center gap-1 rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-700",children:[(0,r.jsx)(d.Z,{className:"h-3 w-3"}),"已发布"]}):(0,r.jsxs)("span",{className:"flex items-center gap-1 rounded-full bg-gray-100 px-3 py-1 text-sm font-medium text-gray-700",children:[(0,r.jsx)(f.Z,{className:"h-3 w-3"}),"草稿"]})]}),(0,r.jsx)("h3",{className:"mb-1 text-xl font-semibold text-gray-900",children:e.title}),(0,r.jsx)("p",{className:"mb-2 text-gray-600",children:e.description}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4"}),(0,r.jsxs)("span",{children:[e.lessonCount," 关卡"]})]}),(0,r.jsxs)("div",{children:["创建于 ",new Date(e.created_at).toLocaleDateString()]})]})]}),(0,r.jsxs)("div",{className:"flex shrink-0 gap-2",children:[(0,r.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>w(e.id,e.is_published),className:"gap-2",children:e.is_published?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{className:"h-4 w-4"}),"下架"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.Z,{className:"h-4 w-4"}),"发布"]})}),(0,r.jsx)(x.default,{href:"/admin/courses/".concat(e.id,"/edit"),children:(0,r.jsxs)(o.z,{variant:"outline",size:"sm",className:"gap-2",children:[(0,r.jsx)(p.Z,{className:"h-4 w-4"}),"编辑"]})}),(0,r.jsxs)(o.z,{variant:"outline",size:"sm",onClick:()=>k(e.id),className:"gap-2 text-red-600",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4"}),"删除"]})]})]},e.id))}):(0,r.jsxs)("div",{className:"rounded-2xl border bg-white p-12 text-center shadow-lg",children:[(0,r.jsx)(m.Z,{className:"mx-auto mb-4 h-16 w-16 text-gray-400"}),(0,r.jsx)("h3",{className:"mb-2 text-xl font-semibold text-gray-700",children:"还没有课程"}),(0,r.jsx)("p",{className:"mb-4 text-gray-600",children:"创建你的第一个课程吧!"}),(0,r.jsx)(x.default,{href:"/admin/courses/new",children:(0,r.jsxs)(o.z,{className:"gap-2",children:[(0,r.jsx)(u.Z,{className:"h-4 w-4"}),"创建课程"]})})]})]})})}},575:function(e,t,n){"use strict";n.d(t,{z:function(){return c}});var r=n(3827),s=n(4090),i=n(9143),a=n(9769),l=n(2169);let o=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:n,variant:s,size:a,asChild:c=!1,...u}=e,d=c?i.g7:"button";return(0,r.jsx)(d,{className:(0,l.cn)(o({variant:s,size:a,className:n})),ref:t,...u})});c.displayName="Button"},6862:function(e,t,n){"use strict";n.d(t,{pm:function(){return f}});var r=n(4090);let s=0,i=new Map,a=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?a(n):e.toasts.forEach(e=>{a(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],c={toasts:[]};function u(e){c=l(c,e),o.forEach(e=>{e(c)})}function d(e){let{...t}=e,n=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>u({type:"DISMISS_TOAST",toastId:n});return u({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||r()}}}),{id:n,dismiss:r,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function f(){let[e,t]=r.useState(c);return r.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},2169:function(e,t,n){"use strict";n.d(t,{IN:function(){return o},Iv:function(){return u},cn:function(){return i},fy:function(){return f},uf:function(){return a},vV:function(){return d},yF:function(){return c}});var r=n(3167),s=n(1367);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,r.W)(t))}function a(e){return new Intl.NumberFormat("zh-CN").format(e)}function l(e){return e*(e+1)*50}function o(e){let t=1,n=0;for(;n+l(t)<=e&&t<10;)n+=l(t),t++;let r=e-n,s=l(t);return{level:t,currentXP:r,nextLevelXP:s,progress:Math.min(r/s*100,100)}}function c(e){return["新手","学徒","练习生","开发者","工程师","专家","大师","宗师","传奇","网页高手"][e-1]||"未知"}function u(e){return({common:"text-gray-500 bg-gray-100",rare:"text-blue-500 bg-blue-100",epic:"text-purple-500 bg-purple-100",legendary:"text-orange-500 bg-orange-100"})[e]}function d(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function f(e){let t=0;return e.length>=8&&t++,e.length>=12&&t++,/[a-z]/.test(e)&&/[A-Z]/.test(e)&&t++,/\d/.test(e)&&t++,/[^a-zA-Z0-9]/.test(e)&&t++,Math.min(t,4)}},1266:function(e,t,n){"use strict";n.d(t,{F:function(){return i},e:function(){return a}});var r=n(4090);function s(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return e=>{let n=!1,r=t.map(t=>{let r=s(t,e);return n||"function"!=typeof r||(n=!0),r});if(n)return()=>{for(let e=0;e<r.length;e++){let n=r[e];"function"==typeof n?n():s(t[e],null)}}}}function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.useCallback(i(...t),t)}},9143:function(e,t,n){"use strict";n.d(t,{Z8:function(){return a},g7:function(){return l}});var r=n(4090),s=n(1266),i=n(3827);function a(e){let t=function(e){let t=r.forwardRef((e,t)=>{let{children:n,...i}=e;if(r.isValidElement(n)){var a,l;let e,o;let c=(e=null===(a=Object.getOwnPropertyDescriptor(n.props,"ref"))||void 0===a?void 0:a.get)&&"isReactWarning"in e&&e.isReactWarning?n.ref:(e=null===(l=Object.getOwnPropertyDescriptor(n,"ref"))||void 0===l?void 0:l.get)&&"isReactWarning"in e&&e.isReactWarning?n.props.ref:n.props.ref||n.ref,u=function(e,t){let n={...t};for(let r in t){let s=e[r],i=t[r];/^on[A-Z]/.test(r)?s&&i?n[r]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let r=i(...t);return s(...t),r}:s&&(n[r]=s):"style"===r?n[r]={...s,...i}:"className"===r&&(n[r]=[s,i].filter(Boolean).join(" "))}return{...e,...n}}(i,n.props);return n.type!==r.Fragment&&(u.ref=t?(0,s.F)(t,c):c),r.cloneElement(n,u)}return r.Children.count(n)>1?r.Children.only(null):null});return t.displayName="".concat(e,".SlotClone"),t}(e),n=r.forwardRef((e,n)=>{let{children:s,...a}=e,l=r.Children.toArray(s),o=l.find(c);if(o){let e=o.props.children,s=l.map(t=>t!==o?t:r.Children.count(e)>1?r.Children.only(null):r.isValidElement(e)?e.props.children:null);return(0,i.jsx)(t,{...a,ref:n,children:r.isValidElement(e)?r.cloneElement(e,void 0,s):null})}return(0,i.jsx)(t,{...a,ref:n,children:s})});return n.displayName="".concat(e,".Slot"),n}var l=a("Slot"),o=Symbol("radix.slottable");function c(e){return r.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===o}},9769:function(e,t,n){"use strict";n.d(t,{j:function(){return a}});var r=n(3167);let s=e=>"boolean"==typeof e?"".concat(e):0===e?"0":e,i=r.W,a=(e,t)=>n=>{var r;if((null==t?void 0:t.variants)==null)return i(e,null==n?void 0:n.class,null==n?void 0:n.className);let{variants:a,defaultVariants:l}=t,o=Object.keys(a).map(e=>{let t=null==n?void 0:n[e],r=null==l?void 0:l[e];if(null===t)return null;let i=s(t)||s(r);return a[e][i]}),c=n&&Object.entries(n).reduce((e,t)=>{let[n,r]=t;return void 0===r||(e[n]=r),e},{});return i(e,o,null==t?void 0:null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:n,className:r,...s}=t;return Object.entries(s).every(e=>{let[t,n]=e;return Array.isArray(n)?n.includes({...l,...c}[t]):({...l,...c})[t]===n})?[...e,n,r]:e},[]),null==n?void 0:n.class,null==n?void 0:n.className)}}},function(e){e.O(0,[150,491,792,269,971,69,744],function(){return e(e.s=9586)}),_N_E=e.O()}]);