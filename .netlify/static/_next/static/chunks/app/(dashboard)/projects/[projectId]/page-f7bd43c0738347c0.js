(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[51],{7138:function(e,s,t){Promise.resolve().then(t.bind(t,1161))},3879:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(7461).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},9990:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(7461).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},9295:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(7461).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]])},489:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});/**
 * @license lucide-react v0.323.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,t(7461).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},1161:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return _}});var a=t(3827),r=t(4090),l=t(7907),i=t(8792),n=t(7269),c=t(1097),d=t(575),u=t(6862),o=t(3879),m=t(9295),x=t(489),h=t(5211),f=t(5323),p=t(2805),j=t(7841),v=t(9990);function _(){var e,s,t;let _=(0,l.useParams)(),y=(0,l.useRouter)(),{profile:g}=(0,n.a)(),{toast:N}=(0,u.pm)(),b=_.projectId,[w,k]=(0,r.useState)(null),[Z,q]=(0,r.useState)([]),[z,S]=(0,r.useState)(""),[C,M]=(0,r.useState)(!0),[E,L]=(0,r.useState)(!1),[D,P]=(0,r.useState)(!1),[H,O]=(0,r.useState)(0);(0,r.useEffect)(()=>{b&&(A(),T())},[b,g]);let A=async()=>{let e=(0,c.e)(),{data:s}=await e.from("projects").select("\n        *,\n        users!projects_user_id_fkey(id, display_name, avatar_url, level)\n      ").eq("id",b).single();if(!s){y.push("/community");return}k(s);let{count:t}=await e.from("project_likes").select("*",{count:"exact",head:!0}).eq("project_id",b);if(O(t||0),g){let{data:s}=await e.from("project_likes").select("id").eq("user_id",g.id).eq("project_id",b).single();L(!!s);let{data:t}=await e.from("user_bookmarks").select("id").eq("user_id",g.id).eq("project_id",b).single();P(!!t)}let{data:a}=await e.from("comments").select("\n        *,\n        users!comments_user_id_fkey(display_name, avatar_url, level)\n      ").eq("project_id",b).order("created_at",{ascending:!1});a&&q(a.map(e=>({id:e.id,content:e.content,created_at:e.created_at,user:{display_name:e.users.display_name||"Anonymous",avatar_url:e.users.avatar_url,level:e.users.level}}))),M(!1)},T=async()=>{let e=(0,c.e)();await e.rpc("increment_view_count",{project_id:b})},V=async()=>{if(!g){N({title:"请先登录",variant:"destructive"});return}let e=(0,c.e)();E?(await e.from("project_likes").delete().eq("user_id",g.id).eq("project_id",b),L(!1),O(H-1)):(await e.from("project_likes").insert({user_id:g.id,project_id:b}),L(!0),O(H+1))},I=async()=>{if(!g){N({title:"请先登录",variant:"destructive"});return}let e=(0,c.e)();D?(await e.from("user_bookmarks").delete().eq("user_id",g.id).eq("project_id",b),P(!1),N({title:"已取消收藏"})):(await e.from("user_bookmarks").insert({user_id:g.id,project_id:b}),P(!0),N({title:"收藏成功!"}))},R=async()=>{if(!g){N({title:"请先登录",variant:"destructive"});return}if(!z.trim())return;let e=(0,c.e)(),{data:s,error:t}=await e.from("comments").insert({project_id:b,user_id:g.id,content:z.trim()}).select("\n        *,\n        users!comments_user_id_fkey(display_name, avatar_url, level)\n      ").single();t?N({title:"评论失败",variant:"destructive"}):(S(""),A(),N({title:"评论成功!"}))},Y=async()=>{if(!g||!w||w.user_id!==g.id||!confirm("确定要删除这个作品吗?"))return;let e=(0,c.e)(),{error:s}=await e.from("projects").delete().eq("id",b);s?N({title:"删除失败",variant:"destructive"}):(N({title:"作品已删除"}),y.push("/community"))};if(C||!w)return(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsx)("div",{className:"loading-spinner"})});let B=(null==g?void 0:g.id)===w.user_id;return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 p-6",children:(0,a.jsxs)("div",{className:"mx-auto max-w-5xl",children:[(0,a.jsx)(i.default,{href:"/community",children:(0,a.jsxs)(d.z,{variant:"ghost",className:"mb-6 gap-2",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),"返回社区"]})}),(0,a.jsxs)("div",{className:"mb-6 rounded-2xl border bg-white p-8 shadow-lg",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h1",{className:"mb-2 text-3xl font-bold text-gray-900",children:w.title}),(0,a.jsx)("p",{className:"text-gray-600",children:w.description})]}),B&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.default,{href:"/projects/".concat(b,"/edit"),children:(0,a.jsxs)(d.z,{variant:"outline",size:"sm",className:"gap-2",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4"}),"编辑"]})}),(0,a.jsxs)(d.z,{variant:"outline",size:"sm",onClick:Y,className:"gap-2 text-red-600",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4"}),"删除"]})]})]}),(0,a.jsxs)("div",{className:"mb-6 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-400 to-purple-400 text-lg font-semibold text-white",children:w.users.avatar_url?(0,a.jsx)("img",{src:w.users.avatar_url,alt:w.users.display_name,className:"h-full w-full rounded-full object-cover"}):w.users.display_name[0]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:w.users.display_name}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Level ",w.users.level]})]})]}),(0,a.jsx)("div",{className:"mb-6 overflow-hidden rounded-lg border",children:(0,a.jsx)("iframe",{srcDoc:"\n                <!DOCTYPE html>\n                <html>\n                  <head>\n                    <style>".concat((null===(e=w.code_snapshot)||void 0===e?void 0:e.css)||"","</style>\n                  </head>\n                  <body>\n                    ").concat((null===(s=w.code_snapshot)||void 0===s?void 0:s.html)||"","\n                    <script>").concat((null===(t=w.code_snapshot)||void 0===t?void 0:t.js)||"","</script>\n                  </body>\n                </html>\n              "),className:"h-[500px] w-full bg-white",sandbox:"allow-scripts"})}),(0,a.jsxs)("div",{className:"flex items-center justify-between border-t pt-4",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(d.z,{variant:E?"default":"outline",onClick:V,className:"gap-2",children:[(0,a.jsx)(h.Z,{className:E?"fill-current":""}),(0,a.jsx)("span",{children:H})]}),(0,a.jsxs)(d.z,{variant:D?"default":"outline",onClick:I,className:"gap-2",children:[(0,a.jsx)(f.Z,{className:D?"fill-current":""}),"收藏"]}),(0,a.jsxs)(d.z,{variant:"outline",className:"gap-2",children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),"分享"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:[w.view_count||0," 次浏览"]})]})]})]}),(0,a.jsxs)("div",{id:"comments",className:"rounded-2xl border bg-white p-8 shadow-lg",children:[(0,a.jsxs)("h2",{className:"mb-6 text-2xl font-bold text-gray-900",children:["评论 (",Z.length,")"]}),g&&(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("textarea",{value:z,onChange:e=>S(e.target.value),placeholder:"写下你的评论...",className:"w-full rounded-lg border p-4 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3}),(0,a.jsx)("div",{className:"mt-2 flex justify-end",children:(0,a.jsxs)(d.z,{onClick:R,disabled:!z.trim(),className:"gap-2",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4"}),"发表评论"]})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[Z.map(e=>(0,a.jsxs)("div",{className:"flex gap-3 border-b pb-4 last:border-b-0",children:[(0,a.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-blue-400 to-purple-400 text-sm font-semibold text-white",children:e.user.avatar_url?(0,a.jsx)("img",{src:e.user.avatar_url,alt:e.user.display_name,className:"h-full w-full rounded-full object-cover"}):e.user.display_name[0]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"mb-1 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.user.display_name}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["Lv",e.user.level]}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:new Date(e.created_at).toLocaleDateString()})]}),(0,a.jsx)("p",{className:"text-gray-700",children:e.content})]})]},e.id)),0===Z.length&&(0,a.jsx)("p",{className:"py-8 text-center text-gray-500",children:"还没有评论,来发表第一条吧!"})]})]})]})})}}},function(e){e.O(0,[150,491,792,269,44,971,69,744],function(){return e(e.s=7138)}),_N_E=e.O()}]);