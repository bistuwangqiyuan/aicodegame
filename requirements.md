# GameCode Lab - 需求文档

## 项目概述

**项目名称**: GameCode Lab — 游戏化的 HTML5 编程教育平台

**项目愿景**: 构建一个基于浏览器、完全AI驱动的游戏化在线编程学习平台，让零基础用户通过任务闯关、AI实时反馈、积分与成就机制，系统掌握 HTML5、CSS、JavaScript 等 Web 基础开发技能。

**核心技术栈**:
- 开发框架：Next.js 14 + TypeScript
- 数据库：Supabase（PostgreSQL + Auth + Edge Functions）
- AI 引擎：DeepSeek（用于代码生成、讲解、纠错、学习建议）
- 前端执行环境：浏览器内置代码沙盒
- UI 框架：Tailwind CSS + shadcn/ui
- 状态管理：Zustand 或 Recoil
- 部署：Netlify

---

## 功能需求

### 1. 用户与权限系统

#### 1.1 游客试用系统

**用户故事**: 作为一个潜在用户，我希望能够在不注册的情况下免费试用全部功能1个月，这样我可以在决定注册前充分了解平台。

**验收标准**:
- **WHEN** 用户首次访问网站 **THEN** 系统自动分配一个临时账号标识
- **WHEN** 游客使用平台 **THEN** 系统记录试用开始时间
- **WHEN** 试用期满1个月 **THEN** 系统显示注册提示并限制进一步访问
- **WHERE** 游客模式下 **WHEN** 用户完成学习任务 **THEN** 进度数据临时保存在本地存储或Supabase临时表中
- **WHEN** 游客选择注册 **THEN** 系统将试用期间的学习进度迁移到正式账号

#### 1.2 用户注册与认证

**用户故事**: 作为一个新用户，我希望能够通过多种方式注册和登录账号，这样我可以方便地访问平台并保存我的学习进度。

**验收标准**:
- **WHEN** 用户访问注册页面 **THEN** 系统提供邮箱注册和第三方OAuth登录选项（Google, GitHub）
- **WHERE** 注册表单 **WHEN** 用户提交注册信息 **THEN** 系统验证邮箱格式和密码强度（至少8位，包含字母和数字）
- **WHEN** 邮箱注册成功 **THEN** 系统发送验证邮件到用户邮箱
- **WHEN** 用户点击验证链接 **THEN** 账号激活并自动登录
- **WHEN** 用户使用OAuth登录 **THEN** 系统通过Supabase Auth处理第三方认证
- **WHEN** 登录失败 **THEN** 系统显示清晰的错误提示

#### 1.3 用户角色与权限管理

**用户故事**: 作为平台管理员，我希望系统支持不同的用户角色，这样可以为学生、教师和管理员提供差异化的功能权限。

**验收标准**:
- **WHEN** 用户注册时 **THEN** 系统默认分配"学生用户"角色
- **WHERE** 用户管理界面 **WHEN** 管理员操作 **THEN** 可以将用户升级为"教师"或"管理员"角色
- **WHEN** 学生用户登录 **THEN** 可访问课程学习、作品创作、排行榜、AI助教功能
- **WHEN** 教师用户登录 **THEN** 除学生功能外，可访问课程创建、关卡设计、学生表现查看功能
- **WHEN** 管理员登录 **THEN** 可访问所有功能，包括系统设置、AI引擎管理、课程审核、安全监控

#### 1.4 用户档案与学习追踪

**用户故事**: 作为一个学生用户，我希望查看我的个人资料、学习进度和成就，这样我可以了解自己的学习状态。

**验收标准**:
- **WHEN** 用户访问个人中心 **THEN** 显示用户名、头像、当前等级、经验值、金币、徽章
- **WHEN** 用户查看学习进度 **THEN** 显示已完成的关卡数、总学习时长、当前课程进度条
- **WHEN** 用户查看成就墙 **THEN** 显示已解锁和未解锁的成就徽章及获取条件
- **WHERE** 个人中心 **WHEN** 用户点击"学习曲线" **THEN** 以图表形式展示每日学习时长和XP增长趋势
- **WHEN** 用户完成里程碑（如达到Lv5、完成50个任务） **THEN** 系统弹窗庆祝并记录到成就系统

---

### 2. 课程与任务模块

#### 2.1 HTML5基础课程（Level 1）

**用户故事**: 作为零基础学习者，我希望通过游戏化的方式学习HTML5基础标签和结构，这样我可以轻松理解网页的基本构成。

**验收标准**:
- **WHEN** 用户进入Level 1 **THEN** 显示HTML5学习地图，包含10-15个关卡
- **WHEN** 用户点击关卡 **THEN** 显示关卡目标（如"学习<h1>标题标签"）和预计完成时间
- **WHERE** 关卡内 **WHEN** 用户阅读AI生成的讲解 **THEN** 内容包含标签定义、示例代码、使用场景
- **WHEN** 用户完成练习任务 **THEN** AI实时检测代码正确性并给出反馈
- **IF** 代码正确 **THEN** 解锁下一关卡并奖励XP和金币
- **IF** 代码错误 **THEN** AI助教以自然语言指出错误并给出修改建议
- **WHEN** 完成Level 1所有关卡 **THEN** 解锁Level 2并获得"HTML5新手"徽章

#### 2.2 CSS样式课程（Level 2）

**用户故事**: 作为学完HTML基础的学习者，我希望学习CSS样式设计，这样我可以美化网页并实现各种布局效果。

**验收标准**:
- **WHEN** 用户进入Level 2 **THEN** 显示CSS学习地图，包含颜色、字体、布局、动画等模块
- **WHERE** "装扮网页角色"任务 **WHEN** 用户为网页元素添加样式 **THEN** 预览区实时显示样式效果
- **WHEN** 用户完成CSS布局任务 **THEN** AI评分并对比标准答案，指出可优化之处
- **WHEN** 完成动画关卡 **THEN** 用户获得特殊奖励"动画大师"称号
- **WHEN** 完成Level 2 **THEN** 解锁Level 3并获得"样式设计师"徽章

#### 2.3 JavaScript基础语法课程（Level 3）

**用户故事**: 作为想要让网页具备交互能力的学习者，我希望学习JavaScript基础语法，这样我可以编写简单的程序逻辑。

**验收标准**:
- **WHEN** 用户进入Level 3 **THEN** 显示JS学习地图，包含变量、函数、条件、循环、事件等模块
- **WHERE** 答题闯关模式 **WHEN** 用户提交代码答案 **THEN** AI即时判断并解释执行结果
- **WHEN** 用户遇到语法错误 **THEN** AI助教以对话形式指出错误位置和原因
- **WHEN** 用户请求帮助 **THEN** AI提供代码提示和相关知识点链接
- **WHEN** 完成Level 3 **THEN** 解锁Level 4并获得"JS学徒"徽章

#### 2.4 DOM操作课程（Level 4）

**用户故事**: 作为掌握基础语法的学习者，我希望学习如何操作网页元素，这样我可以创建动态交互网页。

**验收标准**:
- **WHEN** 用户进入Level 4 **THEN** 显示DOM操作学习地图，包含元素选择、事件监听、动态修改等
- **WHERE** "动态网页小游戏"任务 **WHEN** 用户编写点击按钮改变颜色的代码 **THEN** 实时预览区展示交互效果
- **WHEN** 用户完成事件监听任务 **THEN** 系统记录完成时间并与其他用户对比
- **WHEN** 完成Level 4 **THEN** 解锁Level 5并获得"交互工程师"徽章

#### 2.5 综合实战项目（Level 5）

**用户故事**: 作为完成基础学习的学习者，我希望独立完成一个完整的网页项目，这样我可以巩固所学知识并展示我的能力。

**验收标准**:
- **WHEN** 用户进入Level 5 **THEN** 系统提供5个项目选项（如个人主页、计算器、待办清单、小游戏、作品集）
- **WHEN** 用户选择项目 **THEN** AI生成项目需求文档和评分标准
- **WHERE** 项目开发过程 **WHEN** 用户编写代码 **THEN** AI实时提供优化建议和代码审查
- **WHEN** 用户提交作品 **THEN** AI按照功能完整性、代码质量、创意性三个维度评分
- **WHEN** 作品得分≥80分 **THEN** 自动发布到作品展示墙并获得"网页高手"称号
- **WHEN** 完成Level 5 **THEN** 用户达到Lv10最高等级

#### 2.6 AI自动生成关卡

**用户故事**: 作为教师用户，我希望利用AI自动生成个性化的学习关卡，这样我可以快速创建符合学生水平的教学内容。

**验收标准**:
- **WHERE** 教师后台 **WHEN** 教师输入关卡主题（如"flexbox布局"） **THEN** DeepSeek API生成包含讲解、示例代码、练习题的完整关卡
- **WHEN** AI生成关卡 **THEN** 内容包含3个难度递进的练习题
- **WHEN** 教师审核关卡 **THEN** 可编辑AI生成的内容或直接发布
- **WHEN** 关卡发布后 **THEN** 学生可在课程列表中看到并开始学习

---

### 3. 游戏化机制

#### 3.1 等级与经验值系统

**用户故事**: 作为学习者，我希望通过完成任务获得经验值并升级，这样我可以感受到学习的进步和成就感。

**验收标准**:
- **WHEN** 新用户注册 **THEN** 初始等级为Lv1，XP为0
- **WHEN** 用户完成一个简单任务 **THEN** 获得10-20 XP
- **WHEN** 用户完成一个中等难度任务 **THEN** 获得30-50 XP
- **WHEN** 用户完成一个困难任务或综合项目 **THEN** 获得80-150 XP
- **WHEN** 用户累积XP达到等级阈值 **THEN** 自动升级并播放升级动画
- **WHERE** 个人中心 **WHEN** 用户查看等级 **THEN** 显示当前等级、下一级所需XP、等级称号（如Lv1新手、Lv5学徒、Lv10高手）

#### 3.2 金币与奖励系统

**用户故事**: 作为学习者，我希望通过学习赚取金币并购买虚拟物品，这样可以增加学习的趣味性。

**验收标准**:
- **WHEN** 用户完成任务 **THEN** 除XP外还获得金币奖励（任务难度越高金币越多）
- **WHEN** 用户访问商店 **THEN** 可以用金币购买编辑器主题、头像框、称号、特殊效果
- **WHEN** 用户连续7天登录 **THEN** 获得额外金币奖励
- **WHEN** 用户购买物品后 **THEN** 金币扣除并物品立即生效

#### 3.3 成就系统

**用户故事**: 作为学习者，我希望通过解锁成就徽章来记录我的学习里程碑，这样我可以分享我的成就。

**验收标准**:
- **WHEN** 用户首次运行代码成功 **THEN** 解锁"Hello World"徽章
- **WHEN** 用户连续7天学习 **THEN** 解锁"坚持不懈"徽章
- **WHEN** 用户挑战无错误通过 **THEN** 解锁"完美主义者"徽章
- **WHEN** 用户帮助他人（评论或点赞作品） **THEN** 解锁"乐于助人"徽章
- **WHEN** 用户完成所有Level 1-5课程 **THEN** 解锁"编程毕业生"终极徽章
- **WHERE** 成就墙 **WHEN** 用户查看 **THEN** 显示所有成就的解锁条件和稀有度

#### 3.4 排行榜系统

**用户故事**: 作为竞争型学习者，我希望看到自己在所有用户中的排名，这样可以激励我更努力学习。

**验收标准**:
- **WHEN** 用户访问排行榜 **THEN** 显示全球XP排行榜（前100名）
- **WHERE** 排行榜页面 **WHEN** 用户切换标签 **THEN** 可查看"本周最活跃"、"完成作品数"、"挑战速度"等不同维度排名
- **WHEN** 用户进入前10名 **THEN** 用户名旁显示特殊标识（如金色边框）
- **WHEN** 用户查看自己排名 **THEN** 显示当前排名和超越下一名所需XP

#### 3.5 任务剧情化

**用户故事**: 作为学习者，我希望学习过程有故事背景，这样学习更有代入感和趣味性。

**验收标准**:
- **WHEN** 用户开始游戏 **THEN** 播放开场动画，介绍"修复崩溃的网页世界"故事背景
- **WHEN** 用户完成每个Level **THEN** 解锁一段剧情动画，推进故事发展
- **WHERE** 关卡介绍 **WHEN** 显示任务 **THEN** 以故事化语言描述（如"邪恶的Bug破坏了导航栏，修复它！"）
- **WHEN** 用户完成最终Level **THEN** 播放结局动画并展示"网页世界已恢复"的结局

#### 3.6 AI Boss对战

**用户故事**: 作为寻求挑战的学习者，我希望挑战AI生成的随机编程题目，这样可以测试我的真实水平。

**验收标准**:
- **WHEN** 用户达到Lv3 **THEN** 解锁"AI Boss对战"功能
- **WHEN** 用户点击挑战 **THEN** DeepSeek随机生成一道限时编程题（如"10分钟内修复这段Bug代码"）
- **WHEN** 挑战开始 **THEN** 显示倒计时和AI Boss对话（如"你能在10分钟内打败我吗？"）
- **IF** 用户在时间内完成 **THEN** 获得3倍XP奖励和特殊徽章
- **IF** 用户超时或失败 **THEN** AI给出详细解析和改进建议
- **WHEN** 用户连续击败3次Boss **THEN** 解锁"Boss杀手"称号

---

### 4. AI助教功能（CodeMentor DS）

#### 4.1 实时代码讲解

**用户故事**: 作为学习者，我希望AI能实时解释我正在学习的代码，这样我可以更快理解每行代码的含义。

**验收标准**:
- **WHERE** 代码编辑器 **WHEN** 用户选中一段代码 **THEN** 右侧面板显示AI生成的逐行注释和解释
- **WHEN** 用户点击代码中的函数或标签 **THEN** AI弹出工具提示，说明其作用和常见用法
- **WHEN** 用户请求深入讲解 **THEN** AI以对话形式详细解释代码逻辑和设计思路

#### 4.2 自动评分与错误提示

**用户故事**: 作为学习者，我希望提交代码后立即知道哪里错了，这样我可以快速改正错误。

**验收标准**:
- **WHEN** 用户运行代码 **THEN** AI在3秒内分析代码并给出评分（0-100分）
- **IF** 代码有语法错误 **THEN** AI高亮错误行并用自然语言解释错误原因（如"第5行缺少分号"）
- **IF** 代码逻辑错误 **THEN** AI指出预期结果与实际结果的差异，并建议调试方法
- **IF** 代码可以优化 **THEN** AI提示优化建议（如"可以使用const代替let"）
- **WHEN** 用户查看评分详情 **THEN** 显示"功能完整性"、"代码规范"、"性能优化"三个维度的分数

#### 4.3 个性化学习建议

**用户故事**: 作为学习者，我希望AI根据我的学习数据提供个性化建议，这样我可以更高效地学习。

**验收标准**:
- **WHEN** 用户完成10个任务后 **THEN** AI分析学习数据并生成学习报告
- **WHERE** 学习报告 **WHEN** 用户查看 **THEN** 显示强项知识点、薄弱知识点、推荐学习路径
- **IF** 用户某类题目错误率高 **THEN** AI推荐相关复习关卡和知识点链接
- **WHEN** 用户学习中断超过3天 **THEN** AI发送提醒邮件并推荐短时复习任务

#### 4.4 自动出题与测验

**用户故事**: 作为学习者，我希望通过AI生成的测验题检验学习成果，这样我可以了解自己是否真正掌握了知识。

**验收标准**:
- **WHEN** 用户完成一个课程模块 **THEN** 系统提示"进行小测验"
- **WHEN** 用户开始测验 **THEN** DeepSeek生成5-10道符合模块内容的题目（选择题、填空题、代码题）
- **WHEN** 用户提交答案 **THEN** AI即时批改并显示正确答案和解析
- **WHEN** 测验得分≥80分 **THEN** 解锁下一模块
- **IF** 测验得分<80分 **THEN** AI建议重新学习特定知识点后重考

#### 4.5 聊天式编程指导

**用户故事**: 作为学习者，我希望能随时向AI提问编程问题，这样我可以得到即时帮助。

**验收标准**:
- **WHEN** 用户点击"AI助教"按钮 **THEN** 打开聊天窗口，显示CodeMentor DS头像和欢迎语
- **WHEN** 用户输入问题（如"如何居中一个div？"） **THEN** AI在5秒内回复答案，包含代码示例和解释
- **WHEN** 用户追问 **THEN** AI基于上下文继续对话
- **WHEN** AI回复包含代码 **THEN** 用户可一键复制到编辑器
- **WHERE** 聊天记录 **WHEN** 用户查看历史对话 **THEN** 可搜索和查看过往所有提问记录

#### 4.6 代码对比与优化建议

**用户故事**: 作为学习者，我希望看到我的代码与标准答案的对比，这样我可以学习更好的写法。

**验收标准**:
- **WHEN** 用户完成任务后 **THEN** 可选择查看"参考答案"
- **WHERE** 对比视图 **WHEN** 显示 **THEN** 左侧是用户代码，右侧是AI推荐的优化版本
- **WHEN** 两段代码差异较大 **THEN** AI高亮不同之处并逐条解释优化点
- **WHEN** 用户查看性能对比 **THEN** 显示两种写法的执行速度和代码可读性评分

---

### 5. 在线编程与沙盒系统

#### 5.1 代码编辑器

**用户故事**: 作为学习者，我希望使用功能完善的在线代码编辑器，这样我可以方便地编写和调试代码。

**验收标准**:
- **WHEN** 用户进入编码界面 **THEN** 显示三栏布局：HTML、CSS、JS编辑器
- **WHERE** 编辑器 **WHEN** 用户输入代码 **THEN** 提供语法高亮、自动缩进、括号匹配功能
- **WHEN** 用户输入代码 **THEN** 编辑器提供智能代码补全（如输入`<d`自动提示`<div>`）
- **WHEN** 用户按Ctrl+S **THEN** 自动保存代码到Supabase
- **WHEN** 用户点击"格式化代码" **THEN** 自动调整代码格式和缩进

#### 5.2 实时预览系统

**用户故事**: 作为学习者，我希望代码修改后立即看到效果，这样我可以快速验证想法。

**验收标准**:
- **WHEN** 用户修改HTML/CSS/JS代码 **THEN** 预览区在1秒内自动更新显示结果
- **WHERE** 预览区 **WHEN** 代码运行 **THEN** 在隔离的Iframe沙盒中执行，确保安全性
- **WHEN** 代码包含console.log **THEN** 预览区底部显示控制台输出
- **WHEN** 代码运行出错 **THEN** 预览区显示错误信息和堆栈跟踪
- **WHEN** 用户切换设备预览模式 **THEN** 可切换到手机、平板、桌面视图

#### 5.3 作品保存与管理

**用户故事**: 作为学习者，我希望保存我的代码作品，这样我可以随时继续编辑或分享给他人。

**验收标准**:
- **WHEN** 用户点击"保存作品" **THEN** 弹出对话框，输入作品名称和描述
- **WHEN** 保存成功 **THEN** 代码存储到Supabase并生成唯一作品ID
- **WHERE** "我的作品"页面 **WHEN** 用户访问 **THEN** 显示所有已保存的作品列表，包含缩略图和元信息
- **WHEN** 用户点击作品 **THEN** 加载代码到编辑器并可继续编辑
- **WHEN** 用户删除作品 **THEN** 系统二次确认后从数据库中删除

#### 5.4 作品导出与部署

**用户故事**: 作为学习者，我希望将我的作品导出或部署到公网，这样我可以分享给朋友或放入简历。

**验收标准**:
- **WHEN** 用户点击"导出" **THEN** 提供以下选项：下载ZIP、下载HTML单文件、生成分享链接
- **WHEN** 用户选择"下载ZIP" **THEN** 生成包含index.html、style.css、script.js的压缩包
- **WHEN** 用户选择"一键部署" **THEN** 通过Netlify或GitHub Pages API自动部署，返回部署URL
- **IF** 部署成功 **THEN** 显示部署链接并可一键复制
- **IF** 部署失败 **THEN** 显示错误原因和重试按钮

#### 5.5 代码沙盒安全性

**用户故事**: 作为平台运营方，我希望确保用户代码在安全环境中运行，这样可以防止恶意代码攻击平台或其他用户。

**验收标准**:
- **WHEN** 用户代码在预览区运行 **THEN** 使用sandboxed iframe隔离执行环境
- **WHEN** 代码尝试访问外部资源 **THEN** 通过CSP（内容安全策略）限制跨域请求
- **WHEN** 代码包含可疑关键词（如eval、document.cookie） **THEN** 系统警告并要求用户确认
- **WHEN** 代码执行超过5秒 **THEN** 自动中止执行并提示"代码执行超时"

---

### 6. 社区与作品展示模块

#### 6.1 作品展示墙

**用户故事**: 作为学习者，我希望将我的优秀作品展示给其他用户，这样我可以获得认可和反馈。

**验收标准**:
- **WHEN** 用户在作品列表中点击"发布到社区" **THEN** 作品显示在公开的作品展示墙
- **WHERE** 作品展示墙 **WHEN** 用户浏览 **THEN** 以瀑布流或网格形式展示所有公开作品
- **WHEN** 用户点击作品卡片 **THEN** 打开作品详情页，显示代码、预览、作者信息、点赞数、评论
- **WHEN** 用户筛选作品 **THEN** 可按"最新"、"最热"、"本周推荐"排序

#### 6.2 点赞、评论与收藏

**用户故事**: 作为社区成员，我希望与其他学习者互动，这样可以相互学习和鼓励。

**验收标准**:
- **WHEN** 用户查看作品 **THEN** 可点击"点赞"按钮，点赞数实时更新
- **WHEN** 用户点击"评论" **THEN** 打开评论输入框，可发表文字评论（最多500字）
- **WHEN** 评论提交 **THEN** 立即显示在作品下方，作者收到通知
- **WHEN** 用户点击"收藏" **THEN** 作品保存到"我的收藏"列表，方便日后查看
- **WHERE** "我的收藏" **WHEN** 用户访问 **THEN** 显示所有已收藏的作品

#### 6.3 每日挑战作品推荐

**用户故事**: 作为学习者，我希望看到每日精选的优秀作品，这样可以获取灵感和学习动力。

**验收标准**:
- **WHEN** 用户访问首页 **THEN** 顶部轮播展示"每日挑战作品推荐"（3-5个作品）
- **WHEN** 推荐算法运行 **THEN** 基于点赞数、完成度、创意性综合评分选出作品
- **WHEN** 用户点击推荐作品 **THEN** 跳转到作品详情页并显示推荐理由

#### 6.4 AI自动点评作品

**用户故事**: 作为作品创作者，我希望获得AI的专业点评，这样可以了解作品的优缺点并改进。

**验收标准**:
- **WHEN** 作品发布到社区 **THEN** DeepSeek自动分析代码并生成点评报告
- **WHERE** 点评报告 **WHEN** 显示 **THEN** 包含"代码质量"、"设计美感"、"创意亮点"、"改进建议"四个部分
- **WHEN** 作品得分≥90分 **THEN** AI自动添加"精选作品"标签并推荐到首页
- **WHEN** 用户查看点评 **THEN** 可点击"优化建议"查看AI生成的改进版代码

---

### 7. 教师功能模块

#### 7.1 课程创建与管理

**用户故事**: 作为教师，我希望创建自定义课程，这样可以为我的学生提供个性化的学习内容。

**验收标准**:
- **WHERE** 教师后台 **WHEN** 教师点击"创建课程" **THEN** 打开课程编辑器
- **WHEN** 教师输入课程名称、描述、难度级别 **THEN** 可添加多个关卡模块
- **WHEN** 教师编辑关卡 **THEN** 可手动编写讲解内容或使用AI生成
- **WHEN** 课程保存 **THEN** 存储到Supabase并生成课程ID
- **WHERE** 课程管理页 **WHEN** 教师访问 **THEN** 显示所有已创建课程，可编辑、删除、发布/下架

#### 7.2 关卡设计工具

**用户故事**: 作为教师，我希望设计互动性强的关卡任务，这样可以提高学生的学习兴趣。

**验收标准**:
- **WHEN** 教师创建关卡 **THEN** 可选择关卡类型（讲解型、练习型、挑战型、项目型）
- **WHERE** 关卡编辑器 **WHEN** 教师设计练习题 **THEN** 可设置初始代码、目标效果、评分规则
- **WHEN** 教师设置评分规则 **THEN** 可定义"必须包含特定标签"、"样式符合要求"等自动判题条件
- **WHEN** 教师预览关卡 **THEN** 以学生视角查看关卡内容和交互流程

#### 7.3 学生表现查看

**用户故事**: 作为教师，我希望查看学生的学习进度和表现，这样可以及时给予指导。

**验收标准**:
- **WHERE** 教师后台 **WHEN** 教师选择课程 **THEN** 显示所有学习该课程的学生列表
- **WHEN** 教师点击学生 **THEN** 显示该学生的学习进度、完成关卡数、测验分数、学习时长
- **WHEN** 学生遇到困难（如某关卡失败3次） **THEN** 系统向教师发送提醒
- **WHERE** 学生详情页 **WHEN** 教师查看 **THEN** 可查看学生提交的所有作品代码

---

### 8. 管理员功能模块

#### 8.1 系统设置与监控

**用户故事**: 作为管理员，我希望监控系统运行状态，这样可以确保平台稳定性。

**验收标准**:
- **WHERE** 管理员后台 **WHEN** 管理员登录 **THEN** 显示系统仪表盘，包含用户数、活跃度、API调用量、错误率
- **WHEN** 系统出现异常（如API调用失败率>10%） **THEN** 自动发送邮件或短信通知管理员
- **WHERE** 监控页面 **WHEN** 管理员查看 **THEN** 可查看过去24小时/7天/30天的系统性能图表

#### 8.2 AI引擎管理

**用户故事**: 作为管理员，我希望管理AI引擎的配置和使用情况，这样可以优化AI服务质量和成本。

**验收标准**:
- **WHERE** AI管理页面 **WHEN** 管理员访问 **THEN** 显示DeepSeek API调用次数、Token消耗量、响应时间
- **WHEN** 管理员更新API配置 **THEN** 可修改API密钥、调用频率限制、超时时间
- **WHEN** AI响应时间过长（>10秒） **THEN** 系统记录日志并提示优化建议

#### 8.3 课程审核

**用户故事**: 作为管理员，我希望审核教师创建的课程，这样可以确保内容质量和安全性。

**验收标准**:
- **WHEN** 教师提交新课程 **THEN** 课程状态设为"待审核"，管理员收到通知
- **WHERE** 审核队列 **WHEN** 管理员查看 **THEN** 显示所有待审核课程列表
- **WHEN** 管理员审核课程 **THEN** 可预览课程内容、关卡设计、AI生成的讲解
- **IF** 课程通过审核 **THEN** 状态改为"已发布"，学生可见
- **IF** 课程未通过审核 **THEN** 管理员留言说明原因，教师收到通知并可修改后重新提交

#### 8.4 用户管理与安全监控

**用户故事**: 作为管理员，我希望管理用户账号并监控安全风险，这样可以维护平台秩序。

**验收标准**:
- **WHERE** 用户管理页面 **WHEN** 管理员搜索用户 **THEN** 显示用户详细信息、注册时间、最后登录时间、学习数据
- **WHEN** 管理员检测到异常行为（如短时间大量API调用） **THEN** 可暂停该用户账号并记录日志
- **WHEN** 用户违反社区规则 **THEN** 管理员可删除违规作品、发出警告或封禁账号
- **WHERE** 安全监控页面 **WHEN** 管理员查看 **THEN** 显示可疑登录记录、失败登录尝试、代码沙盒安全事件

---

### 9. UI与交互需求

#### 9.1 设计风格

**用户故事**: 作为用户，我希望界面美观现代且易于使用，这样可以获得良好的学习体验。

**验收标准**:
- **WHEN** 用户访问网站 **THEN** 整体设计遵循极简现代风格（类似Vercel + Duolingo）
- **WHERE** 配色方案 **WHEN** 应用 **THEN** 使用明亮主题，主色调为蓝色系（代表科技感），辅助色为橙色系（代表游戏化）
- **WHEN** 显示游戏化元素 **THEN** 包含等级徽章、进度条、动画效果，但不过于花哨
- **WHERE** 字体 **WHEN** 应用 **THEN** 使用清晰易读的无衬线字体（如Inter、Roboto）

#### 9.2 动画与反馈

**用户故事**: 作为用户，我希望每个操作都有明确的视觉反馈，这样我可以清楚地知道系统响应。

**验收标准**:
- **WHEN** 用户点击按钮 **THEN** 显示按下动画和Ripple效果
- **WHEN** 页面切换 **THEN** 使用平滑的过渡动画（Framer Motion）
- **WHEN** 用户完成任务 **THEN** 播放成功动画（如烟花、金币掉落）并显示奖励信息
- **WHEN** 加载数据时 **THEN** 显示骨架屏或"AI正在生成关卡..."动画
- **WHEN** 用户升级 **THEN** 全屏播放升级特效和音效（可关闭）

#### 9.3 响应式布局

**用户故事**: 作为移动设备用户，我希望在手机和平板上也能流畅使用平台，这样我可以随时随地学习。

**验收标准**:
- **WHEN** 用户在手机访问 **THEN** 界面自动适配小屏幕，三栏编辑器变为可折叠标签页
- **WHEN** 用户在平板访问 **THEN** 界面优化为双栏布局（编辑器+预览）
- **WHEN** 用户在桌面访问 **THEN** 显示完整的三栏布局和侧边栏
- **WHERE** 所有交互元素 **WHEN** 在移动设备 **THEN** 触摸区域至少44x44px，避免误触

#### 9.4 国际化支持

**用户故事**: 作为非中文用户，我希望使用英文界面，这样可以更好地理解内容。

**验收标准**:
- **WHEN** 用户首次访问 **THEN** 根据浏览器语言自动选择中文或英文
- **WHERE** 设置页面 **WHEN** 用户切换语言 **THEN** 界面所有文本立即更新为所选语言
- **WHEN** AI生成内容 **THEN** 根据用户选择的语言生成对应语言的讲解和反馈
- **WHERE** 课程内容 **WHEN** 教师创建 **THEN** 可选择课程语言（中文/英文）

#### 9.5 无障碍访问

**用户故事**: 作为视障用户，我希望使用屏幕阅读器访问平台，这样我也能学习编程。

**验收标准**:
- **WHEN** 使用屏幕阅读器 **THEN** 所有交互元素有清晰的ARIA标签
- **WHEN** 用户使用键盘导航 **THEN** 可通过Tab键访问所有功能，焦点可见
- **WHERE** 代码编辑器 **WHEN** 视障用户使用 **THEN** 支持纯键盘操作和语音反馈
- **WHERE** 配色 **WHEN** 应用 **THEN** 符合WCAG 2.1 AA级对比度标准

---

### 10. 性能与安全需求

#### 10.1 性能优化

**用户故事**: 作为用户，我希望平台加载和响应速度快，这样可以获得流畅的学习体验。

**验收标准**:
- **WHEN** 用户首次访问首页 **THEN** 页面加载时间<2秒（LCP<2.5秒）
- **WHEN** 用户切换页面 **THEN** 页面响应时间<500ms
- **WHEN** 用户运行代码 **THEN** AI反馈响应时间<5秒
- **WHERE** 图片和资源 **WHEN** 加载 **THEN** 使用懒加载和CDN加速
- **WHEN** 用户在慢速网络 **THEN** 优先加载核心功能，其他内容延迟加载

#### 10.2 数据安全

**用户故事**: 作为用户，我希望我的个人数据和作品安全存储，这样我不用担心数据泄露。

**验收标准**:
- **WHEN** 用户注册或登录 **THEN** 密码使用bcrypt加密存储
- **WHEN** 用户访问API **THEN** 所有请求通过HTTPS传输
- **WHEN** 用户会话创建 **THEN** 使用Supabase JWT认证，Token有效期24小时
- **WHERE** 敏感数据 **WHEN** 存储 **THEN** 符合GDPR和CCPA隐私保护规范
- **WHEN** 用户删除账号 **THEN** 所有相关数据在30天内完全删除

#### 10.3 API限流与防滥用

**用户故事**: 作为平台运营方，我希望防止API滥用，这样可以控制成本并确保服务稳定。

**验收标准**:
- **WHEN** 游客用户调用AI API **THEN** 限制每小时10次
- **WHEN** 注册用户调用AI API **THEN** 限制每小时50次
- **WHEN** 用户超过限流次数 **THEN** 返回429错误并提示"请稍后再试"
- **WHERE** Supabase Edge Functions **WHEN** 调用 **THEN** 验证JWT Token有效性
- **WHEN** 检测到异常高频请求 **THEN** 自动触发验证码或临时封禁IP

#### 10.4 数据备份与恢复

**用户故事**: 作为平台运营方，我希望定期备份数据，这样可以在故障时快速恢复服务。

**验收标准**:
- **WHEN** 每天凌晨3点 **THEN** 自动执行Supabase数据库完整备份
- **WHERE** 备份存储 **WHEN** 保存 **THEN** 保留最近30天的备份文件
- **WHEN** 数据丢失或损坏 **THEN** 管理员可在30分钟内从备份恢复
- **WHERE** 备份日志 **WHEN** 记录 **THEN** 包含备份时间、数据量、状态（成功/失败）

---

### 11. 游客试用系统

#### 11.1 试用期管理

**用户故事**: 作为游客，我希望在试用期内体验全部功能，这样我可以充分评估平台是否适合我。

**验收标准**:
- **WHEN** 游客首次访问 **THEN** 系统在localStorage或Cookie中记录试用开始时间
- **WHEN** 试用期剩余时间 **THEN** 在页面顶部显示"试用剩余X天"提示条
- **WHEN** 试用期满30天 **THEN** 系统弹窗提示注册，并限制继续访问课程和AI功能
- **WHERE** 试用期内 **WHEN** 游客使用功能 **THEN** 无任何限制，与注册用户体验一致

#### 11.2 数据迁移

**用户故事**: 作为试用后决定注册的游客，我希望我的学习进度能保留，这样我不用重新开始。

**验收标准**:
- **WHEN** 游客注册账号 **THEN** 系统检测localStorage中的游客数据
- **IF** 检测到游客数据 **THEN** 弹窗询问"是否导入试用期的学习进度？"
- **IF** 用户选择导入 **THEN** 将游客的XP、等级、完成关卡、作品数据迁移到正式账号
- **IF** 用户选择不导入 **THEN** 清空游客数据，从Lv1新账号开始
- **WHEN** 数据迁移完成 **THEN** 显示"欢迎回来！您的学习进度已恢复"提示

#### 11.3 试用限制提醒

**用户故事**: 作为游客，我希望在试用期快结束时收到提醒，这样我可以决定是否注册。

**验收标准**:
- **WHEN** 试用剩余7天 **THEN** 系统每天登录时显示提醒弹窗
- **WHEN** 试用剩余3天 **THEN** 提醒文案更紧迫，突出注册优势
- **WHEN** 试用剩余1天 **THEN** 在每个页面顶部显示倒计时横幅
- **WHERE** 提醒弹窗 **WHEN** 显示 **THEN** 包含"立即注册"按钮和"继续试用"按钮

---

## 非功能需求

### 12.1 可用性

- **WHEN** 系统正常运行 **THEN** 可用性≥99.5%（允许每月停机时间<4小时）
- **WHEN** 发生故障 **THEN** 在15分钟内检测并开始修复

### 12.2 可扩展性

- **WHEN** 并发用户数增长 **THEN** 系统支持水平扩展，可部署多个Netlify实例
- **WHEN** 数据量增长 **THEN** Supabase数据库可无缝升级存储和性能

### 12.3 可维护性

- **WHEN** 开发新功能 **THEN** 代码遵循TypeScript最佳实践和ESLint规则
- **WHERE** 代码库 **WHEN** 提交 **THEN** 每个组件和函数有清晰的注释和类型定义
- **WHEN** 修复Bug **THEN** 通过Git提交记录和Issue跟踪系统管理

### 12.4 兼容性

- **WHEN** 用户访问 **THEN** 支持Chrome、Firefox、Safari、Edge最新两个版本
- **WHEN** 用户在移动设备 **THEN** 支持iOS 14+和Android 10+系统浏览器

---

## 验收总结

本需求文档涵盖了GameCode Lab平台的核心功能，包括：
- ✅ 用户与权限系统（游客、学生、教师、管理员）
- ✅ 完整的HTML5编程课程体系（Level 1-5）
- ✅ 游戏化机制（等级、金币、成就、排行榜、剧情、AI Boss）
- ✅ AI助教全功能（讲解、评分、建议、出题、聊天、优化）
- ✅ 在线编程沙盒（编辑器、预览、保存、导出、安全）
- ✅ 社区与作品展示（展示墙、互动、推荐、AI点评）
- ✅ 教师与管理员功能
- ✅ UI/UX、性能、安全需求
- ✅ 游客试用系统

所有需求均使用EARS格式编写，可直接用于后续设计和开发。

